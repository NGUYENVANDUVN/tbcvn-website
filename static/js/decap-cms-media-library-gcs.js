!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.DecapCmsMediaLibraryGcs=t():e.DecapCmsMediaLibraryGcs=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e,t,r,a,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,n)}function a(e){return function(){var t=this,a=arguments;return new Promise((function(n,o){var i=e.apply(t,a);function s(e){r(i,n,o,s,l,"next",e)}function l(e){r(i,n,o,s,l,"throw",e)}s(void 0)}))}}e.r(t),e.d(t,{default:()=>d});const n=/^.+?\/v\d+\/b\/(.+?)\/o\/(.+?)\?alt=media.*token=([^&]+)/;class o{constructor(e){var t;const{bucket:r,path:a,projectId:n,apiKey:o,auth:i}=e,s={name:"gcs-api-proxy",url:`${window.location.protocol}//${window.location.host}/api`};this.bucket=r,this.path=a||"",this.projectId=n,this.apiKey=o,this.auth=i,this.apiProxy=null===(t=e.apiProxy)?void 0:t.url,this.apiProxy=this.apiProxy||s.url}upload(e){const{file:t,private:r}=e,n=r?"private":"publicRead",o=`https://storage.googleapis.com/upload/storage/v1/b/${this.bucket}/o?uploadType=media&name=${this.path}${t.name}&predefinedAcl=${n}`;return fetch(o,{method:"POST",headers:{"Content-Type":t.type},body:t}).then((e=>e.json())).then((e=>this.fromGCS(e)))}fromGCS(e){var t;const r=`${this.path}${e.name}`;return{id:e.id,name:e.name,url:`https://storage.googleapis.com/${this.bucket}/${r}`,size:e.size,path:r,media_token:null===(t=e.metadata)?void 0:t.firebaseStorageDownloadTokens}}delete({id:e,name:t,url:r,path:a,media_token:o}){return fetch(`https://storage.googleapis.com/storage/v1/b/${this.bucket}/o/${encodeURIComponent(a)}`,{method:"DELETE"})}list(e){const{path:t,cursor:r}=e,a=`https://storage.googleapis.com/storage/v1/b/${this.bucket}/o?prefix=${t}`;return fetch(r?`${a}&pageToken=${r}`:a).then((e=>e.json())).then((e=>({files:(e.items||[]).map((e=>this.fromGCS(e))),cursor:e.nextPageToken}))}authComponent(){return"div"}fromURL(e){const t=n.exec(e);if(t){const[e,r,a,n]=t;return this.fromGCS({bucket:r,name:a,metadata:{firebaseStorageDownloadTokens:n}})}return null}}const i={name:"gcs",label:"Google Cloud Storage",init:e=>new o(e)};class s{constructor(e,t={}){this.name=i.name,this.label=i.label,this.api=null,this.init=a(this.init.bind(this)),this.gcs=new o(e)}init(){return Promise.resolve({authComponent:()=>"div"})}delete(e){return this.gcs.delete(e)}insert(e){return e}fromURL(e){return this.gcs.fromURL(e)}upload(e){return this.gcs.upload(e)}list(e){return this.gcs.list(e)}}const l={init:e=>new s(e)};const d=l;window.CMS&&window.CMS.registerMediaLibrary(d)})()})();